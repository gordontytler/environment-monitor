<html>
<head>
<title>Environment monitor</title>
<style>body, td, th, p, ul, ol, div {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;}</style></head>
<body>
<h2>Environment monitor</h2>
<!--ERROR-->
<h2>Index</h2>
<hr size="1"/>

<h3>SOAP web service</h3>
For use by environment monitoring clients.
<p>
<a href="http://host-port/Monitor/?wsdl">http://host-port/Monitor/?wsdl</a><br>
<a href="http://host-port/Monitor/?xsd=1">http://host-port/Monitor/?xsd=1</a><br>
<p>
Below are REST style operations more suitable for use in scripts or tests.
<hr size="1"/>

<h3>get</h3>
Scripts can use this to get a file from the environment monitor server. The path after the ? is relative to FullPathToInstallDirectory
 defined in <a href="http://host-port/MonitorScript/get?config.properties">config.properties</a>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/get?/data/environments/env002-dev.txt">http://host-port/MonitorScript/get?/data/environments/env002-dev.txt</a>
<hr size="1"/>

<h3>logon</h3>
Allocates a pseudo-terminal and runs the logon script. 
<p>
If this works a numeric sessionId is returned. Anything else is an error message.
<p>
You may actually get back a recycled existing terminal so there is no guarantee as to the environment variables or working directory.
The logon uses ssh with password authentication and if this fails it will try public key authentication.
Passwords for the default user and the users for paricular machines are in <a href="http://host-port/MonitorScript/get?config.properties">config.properties</a>. For public key encryption run the  the ssh-copy-id command on the environment monitor server (host-port).

<p>
<table cellspacing="10">
<tr><td>host:</td> <td>IP address or domain name.</td></tr>
<tr><td>environmentName:</td> <td>Optional for logon but needed for environment related operations.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/logon?host=node747.test.carrero.es&environmentName=env002%20DEV">http://host-port/MonitorScript/logon?host=node747.test.carrero.es&environmentName=env002%20DEV</a>
<hr size="1"/>

<h3>executeCommand</h3>
Executes a command on a server and returns the initial standard output.
This operation blocks until the command finishes or the DefaultCommandTimeoutMillis has elapsed (see <a href="http://host-port/MonitorScript/get?config.properties">config.properties</a>). After this the command may continue to run on the server.
For more control or a continuous output stream the SOAP executeCommand operation should be used instead.
<table cellspacing="10">
<tr><td>sessionId:</td> <td>returned by logon or right click on the server in the GUI application and select Server->Open Terminal</td></tr>
<tr><td>command:</td> <td>a Linux command</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/executeCommand?sessionId=1234&command=who">http://host-port/MonitorScript/executeCommand?sessionId=1234&command=who</a>
<hr size="1"/>

<h3>addApplication</h3>
Adds an application to the environment view. Called by 
<a href="http://host-port/MonitorScript/get?/data/scripts/discoverApps001.py">discoverApps001.py</a>
<p>
<table cellspacing="10">
<tr><td>sessionId:</td> <td>Indicates which server and environment to add the application to.</td></tr>
<tr><td>nameInEnvironmentView:</td> <td>The application name name displayed on the client.</td></tr>
<tr><td>fileName:</td> <td>The application definition file in environment-monitor/data/applications.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/addApplication?sessionId=1234&nameInEnvironmentView=AUS%20Public&20API&fileName=japi-001.txt">http://host-port/MonitorScript/addApplication?sessionId=1234&nameInEnvironmentView=AUS%20Public&20API&fileName=japi-001.txt</a>
<hr size="1"/>

<h3>applicationIsUp</h3>
Informs the environment monitor that a running process has been found that matches an application defined in data/applications/.
<p>
<table cellspacing="10">
<tr><td>sessionId:</td> <td>Indicates the server and environment.</td></tr>
<tr><td>nameInEnvironmentView:</td> <td>The application display name.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/applicationIsUp?sessionId=1234&nameInEnvironmentView=note-pub%20(UK)">http://host-port/MonitorScript/applicationIsUp?sessionId=1234&nameInEnvironmentView=note-pub%20(UK)</a>
<hr size="1"/>

<h3>finishedHeartbeat</h3>
Informs the environment monitor that a script (actually <a href="http://host-port/MonitorScript/get?/data/scripts/appsHeartbeatOnAllServers001.py">appsHeartbeatOnAllServers001.py</a>)
 has finished checking which applications are up. Any that did not get an applicationIsUp call must be down.
<p>
<table cellspacing="10">
<tr><td>sessionId:</td> <td>Indicates the environment.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/finishedHeartbeat?sessionId=1234">http://host-port/MonitorScript/finishedHeartbeat?sessionId=1234</a>
<hr size="1"/>

<h3>getAllApplications</h3>
Returns all the application definitions.
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/getAllApplications">http://host-port/MonitorScript/getAllApplications</a>
<hr size="1"/>

<h3>getEnvironmentApplications</h3>
Returns the applications assigned to specific servers in an environment. These were either discovered to be running or manually assigned to the server by an entry in a file in /data/environments/.
<table cellspacing="10">
<tr><td>sessions:</td> <td>A comma separated list of sessionIds which identify servers.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/getEnvironmentApplications?sessions=1,2,3">http://host-port/MonitorScript/getEnvironmentApplications?sessions=1,2,3</a>
<hr size="1"/>

<h3>close</h3>
Returns the psuedo-terminal to a pool so that it may be re-used.
<p>
<table cellspacing="10">
<tr><td>sessionId:</td> <td>Indicates the psuedo-terminal.</td></tr>
</table>
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/close?sessionId=1234">http://host-port/MonitorScript/finishedHeartbeat?close=1234</a>
<hr size="1"/>

<h3>writeToServerLog</h3>
Writes everything after the ? to the <a href="http://host-port/MonitorScript/get?/log/environment-monitor-0.log">environment-monitor-0.log</a>
This is useful for debugging scripts. Requires the <a href="http://host-port/MonitorScript/get?logging.properties">logging.properties</a> 
logging level to be FINE.
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/writeToServerLog?This%20is%20a%20test%20URL%20encoded%20debug%20message%20from%20index.html.">http://host-port/MonitorScript/writeToServerLog?This%20is%20a%20test%20URL%20encoded%20debug%20message%20from%20index.html.</a>
<hr size="1"/>

<h3>dumpAllSessionsOnAllServers</h3>
Lists all the sessions.
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/dumpAllSessionsOnAllServers">http://host-port/MonitorScript/dumpAllSessionsOnAllServers</a>
<hr size="1"/>


<h3>getAlreadyRunningCache</h3>
Info about sessions producing continuous output. Used to prevent unnecessary duplication of output and as a failsafe check will killing processes.
<p>
e.g.
<p>
<a href="http://host-port/MonitorScript/getAlreadyRunningCache">http://host-port/MonitorScript/getAlreadyRunningCache</a>
<hr size="1"/>


</body>
</html>
